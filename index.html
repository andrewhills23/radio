<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Radio</title>
    <style>
        body {
            font-family: monospace;
            background: #222;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .radio-box {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            width: 320px;
            border: 2px solid #444;
        }
        .status {
            color: #0f0;
            margin-bottom: 10px;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        #track-name {
            font-weight: bold;
            font-size: 1.1em;
            margin: 15px 0;
            color: #fff;
            min-height: 1.2em;
        }
        #time-display {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        button {
            background: #fff;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            margin-top: 5px;
            width: 100%;
        }
        button:hover {
            background: #ddd;
        }
    </style>
</head>
<body>

<div class="radio-box">
    <div class="status">‚óè LIVE ON AIR</div>
    <div id="track-name">Connecting...</div>
    <div id="time-display">--:--</div>
    
    <audio id="radio-player" preload="auto"></audio>
    
    <button id="play-btn">TUNE IN</button>
</div>

<script>
    // 1. PLAYLIST CONFIGURATION
    // All timestamps converted to seconds. Filenames match your screenshot exactly.
    const playlist = [
        { title: "Not A Virgin Anymore!",                   src: "audio/Not A Virgin Anymore!.mp3",                          duration: 186 },
        { title: "What Happens In Vegas, Stays In Vegas",   src: "audio/What Happens In Vegas, Stays In Vegas.mp3",          duration: 208 },
        { title: "Stefanie's Pregnant (Andy, What Did You Do?)", src: "audio/Stefanie's Pregnant (Andy, What Did You Do_).mp3", duration: 239 },
        { title: "Raven, Let's Get Married!",               src: "audio/Raven, Let's Get Married!.mp3",                      duration: 213 },
        { title: "We've Got Rupert",                        src: "audio/We've Got Rupert.mp3",                               duration: 180 },
        { title: "Jenkins, Is That Cocaine?",               src: "audio/Jenkins, Is That Cocaine_.mp3",                      duration: 162 },
        { title: "Thanksgiving Dinner",                     src: "audio/Thanksgiving Dinner.mp3",                            duration: 182 },
        { title: "Last Strike",                             src: "audio/Last Strike.mp3",                                    duration: 210 },
        { title: "Rupert Is Gay",                           src: "audio/Rupert Is Gay.mp3",                                  duration: 239 },
        { title: "The Death of Jenkins",                    src: "audio/The Death of Jenkins.mp3",                           duration: 234 },
        { title: "I Turned Into A Pterodactyl",             src: "audio/Pterodactyl Smoothie.mp3",                           duration: 165 },
        { title: "Addicted To The 'Pedia",                  src: "audio/Addicted To The 'Pedia.mp3",                         duration: 198 },
        { title: "It's Time To Leave",                      src: "audio/17 Months - It's Time To Leave.mp3",                 duration: 238 },
        { title: "I'm Not An Incel",                        src: "audio/17 Months - I'm Not An Incel.mp3",                   duration: 169 },
        { title: "I'd Leave My Parents' Basement For You",  src: "audio/17 Months - I'd Leave My Parents' Basement For You 2.mp3", duration: 221 },
        { title: "Perched",                                 src: "audio/Perched.mp3",                                        duration: 43  },
        { title: "I Want To Go To Atlantis",                src: "audio/I Want To Go To Atlantis.mp3",                       duration: 54  },
        { title: "Backshots In The Garage",                 src: "audio/Backshots In The Garage.mp3",                        duration: 209 },
        { title: "Blaze and Glory",                         src: "audio/Blaze and Glory.mp3",                                duration: 166 }, // 2:46
        { title: "The Jenksquad Anthem",                    src: "audio/The Jenksquad Anthem.mp3",                           duration: 65  }  // 1:05
    ];

    const player = document.getElementById('radio-player');
    const trackName = document.getElementById('track-name');
    const timeDisplay = document.getElementById('time-display');
    const playBtn = document.getElementById('play-btn');

    // Calculate total playlist duration once on load
    const totalDuration = playlist.reduce((acc, track) => acc + track.duration, 0);

    function syncRadio() {
        const now = Math.floor(Date.now() / 1000); // Current global timestamp in seconds
        let currentPosition = now % totalDuration; // Where we are in the loop
        let timeAccumulator = 0;
        
        for (let track of playlist) {
            // If the current position falls within this track's time window
            if (currentPosition < timeAccumulator + track.duration) {
                const seekTime = currentPosition - timeAccumulator;
                
                // Safe check for current source (prevents null crash)
                const rawSrc = player.getAttribute('src');
                const currentSrc = rawSrc ? decodeURIComponent(rawSrc.split('/').pop()) : "";
                const newSrc = decodeURIComponent(track.src.split('/').pop());

                // Switch track if needed
                if (currentSrc !== newSrc) {
                    player.src = track.src;
                    trackName.innerText = track.title;
                    player.load();
                    player.currentTime = seekTime;
                    
                    // Only play if user has clicked "TUNE IN"
                    if(playBtn.innerText === "STOP") {
                        player.play().catch(e => console.log("Playback prevented:", e));
                    }
                } else {
                    // Drift correction: if off by more than 2 seconds, snap back
                    if (Math.abs(player.currentTime - seekTime) > 2) {
                        player.currentTime = seekTime;
                    }
                }
                
                // Update the visual timer
                let minutes = Math.floor(seekTime / 60);
                let seconds = Math.floor(seekTime % 60);
                timeDisplay.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                return;
            }
            timeAccumulator += track.duration;
        }
    }

    // Check sync every second
    setInterval(syncRadio, 1000);

    // Button Logic
    playBtn.addEventListener('click', () => {
        if (player.paused) {
            syncRadio(); // Sync immediately before playing
            player.play();
            playBtn.innerText = "STOP";
        } else {
            player.pause();
            playBtn.innerText = "TUNE IN";
        }
    });

    // Run once on load to show current song title immediately
    syncRadio();
</script>

</body>
</html>
